<!DOCTYPE html>
<html lang="rw">
<head>
    <meta charset="UTF-8">
    <title>La Providence - TV Optimized Layout</title>
    <style>
        :root {
            --bg: #020617; 
            --card: #1e293b;
            --accent: #00f2ff; 
            --missed: #f43f5e;
            --text-main: #ffffff;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--bg); color: var(--text-main);
            margin: 0; padding: 20px; overflow: hidden; height: 100vh;
            display: grid;
            grid-template-rows: auto 1fr;
            /* Hano niho twahinduye: Waiting (1.2), Hagati (1.5), Missed (0.6) */
            grid-template-columns: 1.2fr 1.5fr 0.6fr; 
            gap: 20px;
            box-sizing: border-box;
        }

        .hospital-header {
            grid-column: span 3;
            text-align: center;
            padding: 10px;
            border-bottom: 3px solid var(--card);
        }
        .hospital-header h1 { margin: 0; font-size: 2.5rem; letter-spacing: 10px; }
        .hospital-header span { color: var(--accent); }

        .section-box {
            background: var(--card); 
            border-radius: 30px; 
            padding: 25px;
            border: 2px solid #334155;
            display: flex; 
            flex-direction: column;
            height: 92%;
        }

        h2 {
            margin: 0 0 20px 0; font-size: 1.2rem; color: var(--accent);
            text-align: center; border-bottom: 2px solid #334155; padding-bottom: 10px;
            text-transform: uppercase;
        }

        /* UWO BAHAMAGAYE (HAGATI) */
        .now-calling {
            background: radial-gradient(circle, #1e293b 0%, #0f172a 100%);
            border: 6px solid #334155;
            justify-content: center; align-items: center;
            text-align: center;
        }
        .label-now { font-size: 2rem; color: var(--accent); font-weight: 800; }
        .current-id { font-size: 15rem; font-weight: 900; color: var(--accent); line-height: 0.9; }
        .current-name { font-size: 3.5rem; font-weight: 700; margin-top: 20px; color: #fff; }

        /* LISTS */
        .list-grid { display: flex; flex-direction: column; gap: 10px; }
        .row {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px; background: rgba(255,255,255,0.05);
            border-radius: 15px;
        }
        
        /* Waiting (Ibumoso - Ubu ni hanini) */
        .waiting-row .name { font-size: 1.4rem; font-weight: 500; }
        .waiting-row .id { font-size: 1.8rem; font-weight: 900; color: var(--accent); }

        /* Missed (Iburyo - Ubu ni hato) */
        .missed-section { border-color: rgba(244, 63, 94, 0.3); }
        .missed-section h2 { color: var(--missed); font-size: 1rem; }
        .missed-row { background: rgba(244, 63, 94, 0.1); padding: 10px; }
        .missed-row .name { font-size: 0.9rem; opacity: 0.7; }
        .missed-row .id { font-size: 1.1rem; font-weight: 800; color: var(--missed); }

        .new-call-flash { animation: flash 0.8s infinite alternate; }
        @keyframes flash { from { border-color: #334155; } to { border-color: var(--accent); } }
    </style>
</head>
<body>

    <header class="hospital-header">
        <h1>LA <span>PROVIDENCE</span></h1>
    </header>

    <div class="section-box">
        <h2>ABATEGEREJE (WAITING)</h2>
        <div id="waitingList" class="list-grid"></div>
    </div>

    <div class="section-box now-calling" id="mainBox">
        <div class="label-now">BINJIRE / ENTER</div>
        <div class="current-id" id="currId">--</div>
        <div class="current-name" id="currName">TEGEREZA...</div>
    </div>

    <div class="section-box missed-section">
        <h2>MISSED</h2>
        <div id="missedList" class="list-grid"></div>
    </div>

    <audio id="ding" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"></audio>

   <script>
    // 1. Configuration yawe (Simbura iyi n'iyo wakuye kuri Firebase Console)
    const firebaseConfig = {
        apiKey: "AIza...",
        authDomain: "laprovidence.firebaseapp.com",
        databaseURL: "https://laprovidence-default-rtdb.firebaseio.com",
        projectId: "laprovidence",
        storageBucket: "laprovidence.appspot.com",
        messagingSenderId: "...",
        appId: "..."
    };

    // Gutangiza Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const queueRef = db.ref('queue');
    const ding = document.getElementById('ding');

    let lastId = null; // Twifashisha iyi kugira ngo tumenye niba hari uwinjiye mushya

    // 2. KUVUGURURA TV (Biba mu buryo bwikora amakuru ahindutse)
    queueRef.on('value', (snapshot) => {
        const data = snapshot.val() || {};
        const current = data.c || null;      // Uwinjiye ubu
        const pending = data.p || [];       // Abategereje
        const missed = data.m || [];        // Abasibye

        const newId = current ? current.id : "--";
        const newName = current ? current.name : "KANDI 'NEXT'";

        // Kwerekana nimero n'izina hagati
        document.getElementById('currId').innerText = newId;
        document.getElementById('currName').innerText = newName;

        // Niba uje ari mushya, vuga "Ding" kandi ukube (Flash)
        if (newId !== lastId && newId !== "--") {
            ding.play().catch(() => {
                console.log("Kanda kuri TV rimwe kugira ngo ijwi ryemerwe!");
            });
            
            const box = document.getElementById('mainBox');
            box.classList.add('new-call-flash');
            setTimeout(() => box.classList.remove('new-call-flash'), 5000);
            
            lastId = newId; // Reba ko uyu muntu twamaze kumwakira
        }

        // Kwerekana urutonde rw'abategereje (Waiting List)
        document.getElementById('waitingList').innerHTML = pending.slice(0, 8).map(p => `
            <div class="row waiting-row">
                <span class="name">${p.name}</span>
                <span class="id">${p.id}</span>
            </div>
        `).join('') || '<div style="text-align:center; opacity:0.2; margin-top:50px;">Nta muntu uri ku murongo</div>';

        // Kwerekana urutonde rw'abasibye (Missed List)
        document.getElementById('missedList').innerHTML = missed.slice(-5).reverse().map(p => `
            <div class="row missed-row">
                <span class="name">${p.name}</span>
                <span class="id">${p.id}</span>
            </div>
        `).join('') || '<div style="text-align:center; opacity:0.2; margin-top:20px;">-</div>';
    });

    // Akanyabugabo: Browser ntibyemera ko ijwi ryi-play-inga utarabanza gukanda kuri page.
    window.onclick = () => {
        ding.play().then(() => {
            ding.pause();
            console.log("Audio Enabled!");
        });
    };
</script>
</body>
</html>